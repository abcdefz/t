<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Coin</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ccxt@4.4.27/dist/ccxt.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
</head>
<body>
    <h1>coin</h1>
    <p>coin</p>
    <label for="exchange-select">Select Exchange:</label>
    <select id="exchange-select">
        <option value="binance">Binance</option>
        <option value="coinbasepro">Coinbase Pro</option>
        <option value="kraken">Kraken</option>
        <!-- 你可以添加更多的交易所 -->
    </select>
    <label for="crypto-select">Select Cryptocurrency:</label>
    <select id="crypto-select">
        <option value="BTC/USDT">BTC/USDT</option>
        <option value="ETH/USDT">ETH/USDT</option>
        <option value="LTC/USDT">LTC/USDT</option>
        <!-- 你可以添加更多的数字货币 -->
    </select>
    <label for="start-date">Start Date:</label>
    <input type="date" id="start-date">
    <label for="end-date">End Date:</label>
    <input type="date" id="end-date">
    <button id="fetch-data">Fetch Data</button>
    <div id="kline-chart" style="width: 100%; height: 600px;"></div>
    <script>
        async function fetchAndRenderData(exchangeId, cryptoPair, startDate, endDate) {
            const ccxt = window.ccxt;
            const exchange = new ccxt[exchangeId]();
            const ohlcv = await exchange.fetch_ohlcv(cryptoPair, '1d', new Date(startDate).getTime(), new Date(endDate).getTime());
            console.log(ohlcv);

            // 处理数据
            const dates = ohlcv.map(item => new Date(item[0]).toISOString().split('T')[0]);
            const data = ohlcv.map(item => [item[1], item[2], item[3], item[4]]);

            // 初始化 echarts 实例
            const chartDom = document.getElementById('kline-chart');
            const myChart = echarts.init(chartDom);
            const option = {
                title: {
                    text: `${cryptoPair} K Line Chart`
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    boundaryGap: false
                },
                yAxis: {
                    type: 'value',
                    scale: true,
                    boundaryGap: ['20%', '20%']
                },
                dataZoom: [
                    {
                        type: 'slider',
                        xAxisIndex: 0,
                        start: 0,
                        end: 100
                    },
                    {
                        type: 'inside',
                        xAxisIndex: 0,
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: cryptoPair,
                        type: 'candlestick',
                        data: data,
                        itemStyle: {
                            color: '#ec0000',
                            color0: '#00da3c',
                            borderColor: '#8A0000',
                            borderColor0: '#008F28'
                        }
                    }
                ]
            };

            // 使用指定的配置项和数据显示图表
            myChart.setOption(option);
        }

        document.getElementById('fetch-data').addEventListener('click', function() {
            const exchangeId = document.getElementById('exchange-select').value;
            const cryptoPair = document.getElementById('crypto-select').value;
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            fetchAndRenderData(exchangeId, cryptoPair, startDate, endDate);
        });

        // 初始加载
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('start-date').value = '2022-01-01';
        document.getElementById('end-date').value = today;
        fetchAndRenderData('binance', 'BTC/USDT', '2022-01-01', today);
    </script>
</body>
</html>
